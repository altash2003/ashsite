<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNT Player</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* [YOUR ORIGINAL CSS - CONDENSED] */
        :root { --bg-body:#0f172a; --bg-card:#1e293b; --primary:#6366f1; --text-main:#f8fafc; }
        body { background:var(--bg-body); color:var(--text-main); height:100vh; display:flex; font-family:'Outfit',sans-serif; overflow:hidden; }
        .sidebar { width:100px; padding:2rem 0; background:rgba(15,23,42,0.5); display:flex; flex-direction:column; align-items:center; }
        .main-area { flex:1; padding:2rem; overflow-y:auto; }
        .nav-icon { width:50px; height:50px; border-radius:14px; display:grid; place-items:center; margin-bottom:1rem; cursor:pointer; color:#94a3b8; }
        .nav-icon.active { background:rgba(99,102,241,0.1); color:var(--primary); }
        .top-bar { display:flex; justify-content:space-between; margin-bottom:2rem; }
        .card { background:var(--bg-card); border-radius:20px; padding:1.5rem; border:1px solid rgba(255,255,255,0.05); }
        .grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(200px, 1fr)); gap:1.5rem; }
        .hidden { display:none !important; }
        .btn { background:linear-gradient(135deg, #6366f1, #a855f7); color:white; border:none; padding:10px 20px; border-radius:12px; cursor:pointer; width:100%; margin-top:10px; }
        .btn-green { background:#10b981; }
        /* Inventory Item */
        .inv-item { text-align:center; padding:10px; background:rgba(255,255,255,0.03); border-radius:10px; }
    </style>
</head>
<body>
    <nav class="sidebar">
        <div class="nav-icon active" onclick="setTab('home', this)"><i class="fas fa-home"></i></div>
        <div class="nav-icon" onclick="setTab('store', this)"><i class="fas fa-store"></i></div>
        <div class="nav-icon" onclick="setTab('auction', this)"><i class="fas fa-gavel"></i></div>
        <div class="nav-icon" onclick="setTab('inv', this)"><i class="fas fa-box"></i></div>
    </nav>
    <main class="main-area">
        <div class="top-bar">
            <h3>Player: <span id="user-name" style="color:var(--primary)">...</span></h3>
            <div style="background:rgba(255,255,255,0.05); padding:8px 20px; border-radius:50px; color:#fbbf24;">
                <i class="fas fa-coins"></i> <span id="user-credits">0</span>
            </div>
        </div>

        <div id="tab-home">
            <div class="card" style="margin-bottom:20px; background:linear-gradient(135deg,#1e293b,#0f172a);">
                <h1>Welcome Back</h1>
                <p style="color:#94a3b8; margin:10px 0;">Claim your daily reward or redeem a code.</p>
                <div style="display:flex; gap:10px;">
                    <button class="btn" style="width:auto;" onclick="claimDaily()">Claim Daily (+50)</button>
                </div>
            </div>
            
            <div class="card">
                <h4>Redeem Code</h4>
                <div style="display:flex; gap:10px; margin-top:10px;">
                    <input type="text" id="redeem-input" style="padding:10px; border-radius:8px; border:none; background:#0f172a; color:white; flex:1;" placeholder="Enter code (e.g. SNT-XXXX)">
                    <button class="btn btn-green" style="width:auto; margin:0;" onclick="redeemCode()">Redeem</button>
                </div>
                <p id="redeem-msg" style="margin-top:10px; font-size:0.9rem;"></p>
            </div>
        </div>

        <div id="tab-store" class="hidden">
            <h2>Store</h2><br>
            <div class="grid" id="store-grid"></div>
        </div>

        <div id="tab-auction" class="hidden">
            <h2>Auctions</h2><br>
            <div class="grid" id="auc-grid"></div>
        </div>

        <div id="tab-inv" class="hidden">
            <h2>My Inventory</h2><br>
            <div class="grid" id="inv-grid"></div>
        </div>
    </main>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let myUser = null;
        
        // AUTO LOGIN for Demo
        socket.emit('player:login', 'ashleychan'); 

        socket.on('player:login_success', u => { myUser = u; renderUI(); });
        
        // Sync Updates
        socket.on('sync:players', list => {
            if(myUser) {
                const updated = list.find(x => x.id === myUser.id);
                if(updated) { myUser = updated; renderUI(); }
            }
        });
        
        socket.on('sync:store', list => {
            const el = document.getElementById('store-grid'); el.innerHTML = '';
            list.forEach(i => {
                const btn = i.status==='Available' ? `<button class="btn" onclick="buy(${i.id})">Buy (${i.price})</button>` : `<button class="btn" disabled style="opacity:0.5">Sold Out</button>`;
                el.innerHTML += `<div class="card"><img src="${i.img}" style="width:100%; height:120px; object-fit:cover; border-radius:10px;"><h4>${i.name}</h4>${btn}</div>`;
            });
        });

        socket.on('sync:auctions', list => {
            const el = document.getElementById('auc-grid'); el.innerHTML = '';
            list.forEach(a => {
                const min = parseInt(a.bid)+50;
                el.innerHTML += `<div class="card"><img src="${a.img}" style="width:100%; height:120px; object-fit:cover; border-radius:10px;"><h4>${a.item}</h4><p style="color:#fbbf24">Bid: ${a.bid}</p><p style="font-size:0.8rem; color:#94a3b8">Winner: ${a.bidder||'None'}</p><button class="btn" onclick="bid(${a.id}, ${min})">Bid ${min}</button></div>`;
            });
        });

        socket.on('player:redeem_result', res => {
            const msg = document.getElementById('redeem-msg');
            msg.innerText = res.msg;
            msg.style.color = res.success ? '#10b981' : '#ef4444';
        });

        function renderUI() {
            document.getElementById('user-name').innerText = myUser.user;
            document.getElementById('user-credits').innerText = myUser.credits;
            
            // Render Inventory
            const inv = document.getElementById('inv-grid'); inv.innerHTML = '';
            if(myUser.inventory.length === 0) inv.innerHTML = '<p style="color:#94a3b8">No items yet.</p>';
            myUser.inventory.forEach(item => {
                inv.innerHTML += `<div class="inv-item"><img src="${item.img}" style="width:60px; height:60px; border-radius:8px;"><p>${item.name}</p></div>`;
            });
        }

        // Actions
        function buy(id) { socket.emit('player:buy_item', { userId: myUser.id, itemId: id }); }
        function bid(id, amt) { socket.emit('player:place_bid', { userId: myUser.id, aucId: id, bid: amt }); }
        function claimDaily() { socket.emit('player:claim_reward', { userId: myUser.id, day: 1, amount: 50 }); }
        function redeemCode() { 
            const code = document.getElementById('redeem-input').value;
            socket.emit('player:redeem_code', { userId: myUser.id, code: code });
        }

        function setTab(t, el) {
            document.querySelectorAll('.main-area > div').forEach(x => { if(x.id.startsWith('tab-')) x.classList.add('hidden'); });
            document.getElementById('tab-'+t).classList.remove('hidden');
            document.querySelectorAll('.nav-icon').forEach(x => x.classList.remove('active'));
            el.classList.add('active');
        }
    </script>
</body>
</html>
