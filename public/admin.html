<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();
    // Re-bind your existing functions to use socket.emit calls instead of local arrays
    // For brevity, I am assuming you use the previous integration I provided for the admin panel logic.
    // If you use your original file, you MUST replace the local array push() logic with socket.emit() calls as shown in previous answers.
    
    // Quick Integration for your specific Admin Panel file:
    socket.on('sync:full_data', (db) => {
        // Map server data to your local variables
        players = db.players;
        storeItems = db.storeItems;
        auctions = db.auctions;
        announcements = db.announcements;
        giftBatches = db.giftBatches;
        systemLogs = db.logs;
        
        // Refresh your tables
        renderPlayers(); renderStore('all'); renderAuctions('all'); renderGiftBatches(); renderAnnouncements(); updateDashboard();
    });

    // Override your Add/Generate functions to talk to server:
    window.addNewStoreItem = function() {
        const name = document.getElementById('new-item-name').value;
        const price = document.getElementById('new-item-price').value;
        const stock = document.getElementById('new-item-stock').value;
        const img = document.getElementById('store-preview').src || 'https://placehold.co/100';
        if(name) socket.emit('admin:add_item', { id: Date.now(), name, price, stock, img, status:'Available' });
    };

    window.addAuction = function() {
        const name = document.getElementById('auc-name').value;
        const bid = document.getElementById('auc-bid').value;
        const dur = document.getElementById('auc-duration').value;
        const img = document.getElementById('auc-preview').src || 'https://placehold.co/100';
        if(name) socket.emit('admin:create_auction', { id: Date.now(), item:name, bid, img, status:'Active', endTime: Date.now() + (dur*3600000) });
    }

    window.generateBatch = function() {
        const type = document.getElementById('gc-type').value;
        const amt = document.getElementById('gc-amount').value;
        const qty = document.getElementById('gc-qty').value;
        const pre = document.getElementById('gc-prefix').value || 'SNT-';
        socket.emit('admin:generate_codes', { id: '#B'+Math.floor(Math.random()*999), type, amount:amt, total:qty, prefix:pre });
    }
    
    window.postAnnouncement = function() {
        const title = document.getElementById('announce-title').value;
        const content = document.getElementById('announce-body').value;
        const img = document.getElementById('announce-preview').src || '';
        socket.emit('admin:post_announcement', { id: Date.now(), title, content, img, likes:0, dislikes:0, comments:[] });
    }
</script>
